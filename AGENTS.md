# AGENTS

Этот файл описывает, как любому ИИ‑агенту (Codex, ChatGPT и т.п.) работать с репозиторием `skillra_hse_pda`.

## 1. Контекст проекта

- Учебный проект по курсу «Python для анализа данных» (ВШЭ).
- Одновременно — технологическая основа продукта Career & Job Market Navigator (Skillra).
- Главный артефакт для проверки курса — ноутбук `notebooks/01_hse_project.ipynb`, который должен полностью выполняться `Run All`.
- Главный артефакт для продукта — пайплайн очистки/фичей + агрегаты рынка и API для персон в `src/skillra_pda`.

## 2. Золотые правила

1. Всегда сначала **прочитай `CODEx_PLAN.md`** и следуй текущему Step N.
2. Меняй только те файлы, которые **явно разрешены** в текущем шаге.
3. **Не трогай сырые данные** в `data/raw/` (особенно `hh_moscow_it_2025_11_30.csv`).
4. **Не ломай пайплайн**:
   - `python scripts/run_pipeline.py` должен успешно отрабатывать.
   - `python scripts/validate_pipeline.py` должен печатать разумные метрики без ошибок.
5. **Не ломай ноутбук**:
   - `notebooks/01_hse_project.ipynb` обязан выполняться целиком (`Run All`) без ошибок.
6. Все графики должны сохраняться через пути из `src/skillra_pda/config.py` (в первую очередь `FIGURES_DIR`), а не через произвольные строки путей.
7. Все тесты должны проходить: `pytest` в корне репозитория должен завершаться без падений.
8. Не используй скрытые глобальные хаки (вроде подмен модулей в `sys.modules`), кроме случаев, когда это явно описано в `CODEx_PLAN.md`.

## 3. Структура репозитория

- `data/raw/` — сырой CSV с hh.ru и, при необходимости, небольшие тестовые выборки.
- `data/processed/`, `data/interim/` — результаты пайплайна (генерируются скриптами, в git по умолчанию не храним).
- `docs/`:
  - `00_assignment_TZ.md` — ТЗ по курсу.
  - `01_product_context_skillra.md` — продуктовый контекст Skillra.
  - `02_feature_dictionary_hh.md` — словарь признаков датасета hh.ru.
- `notebooks/`:
  - `01_hse_project.ipynb` — основной ноутбук со сторилайном (единственный, который проверяет преподаватель).
- `parser/`:
  - `hh_scraper.py` и `parser/README.md` — скрапер hh.ru и его документация.
- `scripts/`:
  - `run_pipeline.py` — полный пайплайн: raw → clean → features → market view.
  - `validate_pipeline.py` — быстрая проверка пайплайна и инвариантов.
  - `validate_notebook.py` — прогон пайплайна + генерация HTML‑отчёта по ноутбуку.
- `src/skillra_pda/`:
  - `config.py` — пути и настройки.
  - `io.py` — загрузка/сохранение датасетов.
  - `cleaning.py` — предобработка и очистка.
  - `features.py` — инженерия признаков.
  - `eda.py` — табличный EDA.
  - `viz.py` — визуализации.
  - `market.py` — агрегаты рынка.
  - `personas.py` — логика анализа персон и skill‑gap.
- `tests/` — юнит‑тесты для ключевых модулей.
- `reports/figures/`, `reports/notebooks/` — генерируемые артефакты (графики и HTML‑отчёты).

## 4. Что трогать нельзя без явного указания

- Любые файлы в `data/raw/`.
- Публичные сигнатуры функций в:
  - `cleaning.py`,
  - `features.py`,
  - `io.py`,
  - `market.py`,
  - `personas.Persona` и `personas.analyze_persona`.
- Тесты в `tests/` (кроме шагов, где явно разрешена правка тестов).
- Исторические md‑файлы в `docs/` — их можно дополнять, но не переписывать с нуля.

## 5. Графики и отчёты

- Все функции из `viz.py` и визуализации в `personas.py`, которые сохраняют графики, должны:
  - использовать `config.FIGURES_DIR` (через `config.FIGURES_DIR / "имя_файла.png"`),
  - возвращать объект `Figure` или `(Figure, Path)` при `return_fig=True`.
- В Jupyter‑ноутбуке:
  - каждая важная визуализация должна быть в отдельной ячейке;
  - последняя строка такой ячейки — объект `Figure`, чтобы график корректно отображался и в Jupyter, и в HTML‑экспорте;
  - сразу после ячейки с графиком должна идти markdown‑ячейка с интерпретацией;
  - названия графиков и подписи осей — на русском языке.

## 6. Как выполнять шаги из CODEx_PLAN.md

1. Определи текущий Step N в `CODEx_PLAN.md`.
2. Внимательно прочитай описание Step N: какие файлы разрешены, какие задачи нужно выполнить.
3. Сначала в чате кратко опиши план изменений, затем вноси правки.
4. После правок:
   - при необходимости запусти `python scripts/run_pipeline.py`;
   - при возможности запусти `python scripts/validate_notebook.py`;
   - запусти `pytest`, если шаг затрагивал код в `src/`.
5. Подготовь PR с именем, указанным в Step N, и в описании перечисли изменённые файлы и причины изменений.

Если инструкция из чата и текст в `CODEx_PLAN.md` расходятся, источником правды считается **`CODEx_PLAN.md`**.
