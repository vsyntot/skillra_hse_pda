# AGENTS.md — правила для Codex / ИИ‑агентов

Репозиторий: `skillra_hse_pda`  
Контекст: учебный проект по курсу **«Python для анализа данных» (ВШЭ)** + фундамент продукта **Career & Job Market Navigator (Skillra)**.

---

## 1. Главный источник правды

1. Основной документ с планом — `CODEx_PLAN.md` в корне репозитория.
2. В `CODEx_PLAN.md` описаны:
   - контекст проекта,
   - архитектура кода,
   - история шагов **Step 0–10** (уже выполнены),
   - и открытые шаги **Step 11** и **Step 12**.
3. Codex **НЕ должен пытаться выполнить все шаги сразу**.  
   Пользователь всегда явно говорит, какой именно шаг (`Step N`) нужно сделать.

Если текущий код/файлы противоречат:
- актуальным инструкциям в `CODEx_PLAN.md` или
- сообщениям пользователя в чате,

приоритет: **сообщения пользователя → CODEx_PLAN.md → существующий код**.

---

## 2. Что уже считается сделанным

1. Шаги **Step 0–10** из `CODEx_PLAN.md` уже реализованы в текущей кодовой базе.
2. Эти шаги используются как:
   - **история** развития проекта,
   - справка по архитектуре и целям.
3. Codex:
   - **не должен** переписывать с нуля модули `cleaning.py`, `features.py`, `eda.py`, `viz.py`, `personas.py`, `market.py`, если пользователь явно не попросил этого;
   - может вносить только **инкрементальные изменения**: добавить график, новый EDA‑блок, улучшить docstring, расширить markdown в ноутбуке и т.п.

---

## 3. Жёсткие ограничения

1. **Сырые данные**:
   - `data/raw/*` — только для чтения (особенно `hh_moscow_it_2025_11_30.csv`);
   - нельзя перезаписывать или менять сырые файлы.

2. **Файловая структура**:
   - Папки: `data/`, `docs/`, `notebooks/`, `parser/`, `src/`, `scripts/`, `tests/`, `reports/` — должны сохраняться.
   - Новые файлы складывать в логичные места:
     - данные → `data/processed/`,
     - графики → `reports/figures/`,
     - код → существующие модули в `src/skillra_pda/` или `parser/`.

3. **Публичный API**:
   - Всё, что экспортируется из `src/skillra_pda/__init__.py`, считается публичным интерфейсом.
   - Менять сигнатуры этих функций можно только при явной просьбе пользователя и с обновлением всех вызовов и тестов.

4. **Тесты**:
   - Нельзя намеренно «ломать» существующие тесты.
   - Если тест обновляется, это должно сопровождаться понятным пояснением (например, расширился API).

5. **Размер PR**:
   - Один шаг (Step N) → один PR, с разумным количеством изменений.
   - Нельзя в рамках одного шага неожиданно менять десятки файлов, не указанных в плане.

---

## 4. Ноутбуки и скрипты

1. **Главный ноутбук**: `notebooks/01_hse_project.ipynb`.
   - После любых изменений он должен выполняться целиком (**Run All**) без ошибок.
   - Ноутбук должен сохранять структуру по этапам ТЗ (0–4), а также продуктовую часть (персоны, выводы).
   - Все ключевые таблицы и графики должны **отображаться** в ноутбуке, а не только сохраняться на диск.

2. **Черновые ноутбуки**:
   - `notebooks/Group_project_draft.ipynb` уже удалён и не должен появляться вновь.

3. **Скрипты**:
   - `scripts/run_pipeline.py` — основной пайплайн (загрузка raw → cleaning → features → market_view);
   - `scripts/validate_pipeline.py` — smoke‑тест пайплайна;
   - `scripts/validate_notebook.py` — проверка выполнения ноутбука.

4. **Парсер**:
   - Логика парсинга hh.ru находится в `parser/` (в частности, `parser/hh_scraper.py`).
   - Codex может только:
     - улучшать читаемость, docstring и CLI‑аргументы,
     - добавлять инструкции по запуску в README.
   - Нельзя превращать парсер в принципиально другой проект.

---

## 5. Как работать с шагами в CODEx_PLAN.md

1. Пользователь формулирует запрос вида:

   > «Сделай сейчас **Step 11** из раздела "Execution steps for Codex" в `CODEx_PLAN.md`.»

   или

   > «Сделай сейчас **Step 12** …»

2. Codex:

   - читает `CODEx_PLAN.md`,
   - находит описание Step N,
   - составляет короткий план действий (какие файлы и как изменяются),
   - вносит изменения **только в перечисленные для Step N файлы**,
   - создаёт PR с названием, указанным в шаге (например, `step11_docs_cleanup` или `step12_investor_story_and_viz`).

3. Codex **НЕ выполняет другие Steps** (`N−1`, `N+1`, …), пока пользователь явно не попросит.

4. Если при чтении кода видно, что работа по шагу фактически уже сделана:
   - Codex может:
     - честно написать, что изменений не требуется,
     - либо сделать минимальный косметический апдейт (улучшить формулировку, добавить пару предложений в markdown), но **не** устраивать массовый рефакторинг.

---

## 6. Запрещённые действия

1. Нельзя удалять или переписывать с нуля:
   - `data/raw/hh_moscow_it_2025_11_30.csv`,
   - `notebooks/01_hse_project.ipynb`,
   - ключевые модули `cleaning.py`, `features.py`, `eda.py`, `viz.py`, `personas.py`, `market.py`,
   - тесты в `tests/`.

2. Нельзя добавлять в репозиторий:
   - секреты (пароли, токены),
   - большие двоичные файлы, не относящиеся к данным проекта.

3. Нельзя менять историю Git (rebase, force‑push) — только обычные коммиты и PR.

---

## 7. Если запрос пользователя не совпадает с планом

Если пользователь просит то, чего нет в `CODEx_PLAN.md` (например, новую фичу):

1. Codex должен:
   - уточнить, какие файлы можно менять,
   - предложить сначала добавить новый шаг в `CODEx_PLAN.md` (как отдельный PR), а затем его реализовывать.

2. По умолчанию Codex действует **консервативно**:
   - минимально необходимый diff,
   - без ломки пайплайна и структуры ноутбука.
