# AGENTS.md — правила для Codex / ИИ‑агентов

Репозиторий: `skillra_hse_pda`  
Контекст: учебный проект по курсу **«Python для анализа данных» (ВШЭ)** + фундамент продукта **Career & Job Market Navigator (Skillra)**.

---

## 1. Главный источник правды

1. Основной рабочий план лежит в файле `CODEx_PLAN.md`.
2. Внутри `CODEx_PLAN.md` есть раздел **«6. Execution steps for Codex»** — там перечислены шаги `Step N`.
3. Codex **НЕ должен** пытаться выполнять все шаги сразу.  
   Пользователь *всегда* явно пишет в чате:  
   > «Сделай сейчас Step N из раздела "6. Execution steps for Codex" в `CODEx_PLAN.md`».
4. Если есть конфликт между:
   - старым кодом/коммитами и
   - актуальными инструкциями в `CODEx_PLAN.md` и сообщениях пользователя,
   то приоритет:  
   **сообщения пользователя → CODEx_PLAN.md → существующий код.**

---

## 2. Жёсткие ограничения

1. **Нельзя трогать сырой датасет** в `data/raw/*`  
   (особенно `data/raw/hh_moscow_it_2025_11_30.csv`).
2. Все новые таблицы и витрины:
   - сохраняем в `data/processed/` или `data/interim/`,
   - форматы: `.parquet` или `.csv`.
3. Все графики и картинки:
   - сохраняем в `reports/figures/` (или подкаталогах),
   - имена файлов — осмысленные, на латинице.
4. HTML‑отчёты из ноутбуков:
   - сохраняем в `reports/notebooks/`.
5. Не добавлять в репозиторий лишних бинарников:
   - никаких `.ipynb_checkpoints`, временных файлов IDE, локальных логов и т.п.
6. **Не меняем API hh.ru и код парсера радикально**, если это не описано в шаге.

---

## 3. Ноутбуки и скрипты

1. Главный ноутбук проекта: `notebooks/01_hse_project.ipynb`.
   - После любых изменений он должен выполняться целиком (**Run All**) без ручных правок.
   - Это **основной рассказ** для преподавателя, команды и потенциальных инвесторов.
2. Вспомогательные ноутбуки:
   - можно использовать только как песочницу,
   - они не обязательны для проверки проекта.
3. Логика данных и аналитики по максимуму живёт в `src/skillra_pda/*.py`.
   - В ноутбуке — только сценарий, вызовы функций, выводы и визуализации.
4. Скрипты:
   - `scripts/validate_pipeline.py` — быстрый smoke‑тест пайплайна.
   - `scripts/run_pipeline.py` — полный аналитический пайплайн (from raw to processed/market view).
   - `scripts/validate_notebook.py` — генерация HTML‑отчёта по основному ноутбуку.

---

## 4. Код и архитектура

1. Основной пакет: `src/skillra_pda/`.  
   Не создавай новые пакеты без веской причины.
2. Новые функции и классы:
   - пиши понятные `docstring`,
   - старайся покрывать их простыми тестами в `tests/`.
3. **Не удаляй** существующие публичные функции (которые вызываются из ноутбука, скриптов или других модулей) без явной инструкции от пользователя.
4. Если меняешь интерфейс функции/класса:
   - обнови все вызовы (`notebooks/`, `scripts/`, `tests/`, `src/skillra_pda`),
   - при необходимости — документацию в `docs/`.
5. Для визуализаций:
   - функции в `viz.py` и `personas.py` по умолчанию сохраняют графики в `reports/figures`,
   - по флагу `return_fig=True` возвращают `Figure`/`Axes` и/или путь к файлу, чтобы ноутбук мог их отрисовать.

---

## 5. Как работать с шагами в `CODEx_PLAN.md`

1. Пользователь в чате явно говорит:  
   > «Сделай сейчас **Step N** из раздела "6. Execution steps for Codex" в `CODEx_PLAN.md`».
2. Codex:
   - читает `CODEx_PLAN.md`,
   - находит **Step N**,
   - вносит изменения **только в файлы, перечисленные в этом шаге**,
   - создаёт отдельный PR с названием, указанным в шаге (например, `step14_notebook_numbers_alignment`).
3. Codex **НЕ** выполняет другие Steps (N–1, N+1 и т.д.), пока пользователь явно не попросит.
4. Исторические шаги **0–13** уже были выполнены.  
   Повторно трогать их логику можно только если пользователь специально попросит «перепройти» конкретный шаг.

---

## 6. Специальные правила для ноутбука и сторителлинга

1. Для каждого крупного блока в `01_hse_project.ipynb` (этап 0–4, EDA‑подразделы, персоны):
   - сначала идёт код/графики,
   - далее **markdown‑ячейка** с:
     - «Что сделали»,
     - «Почему именно так»,
     - «Ключевые цифры» (конкретные числа: N вакансий, % удалёнки и т.п.),
     - «Выводы про рынок»,
     - «Что это даёт продукту Skillra».
2. Там, где текст ссылается на цифры («~60% вакансий remote»),  
   эти цифры должны быть посчитаны в коде **выше** в этом или соседнем блоке.
3. Графики:
   - каждый график (или пара тесно связанных) — в своей ячейке,
   - после него — отдельная markdown‑ячейка с интерпретацией,
   - заголовки и подписи осей — на русском.
4. После любых изменений в ноутбуке:
   - **обязательно** выполнить `Run All` (или через скрипт `validate_notebook.py`, если шаг это требует),
   - убедиться, что HTML‑отчёт генерируется и содержит графики.
