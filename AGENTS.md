# AGENTS.md — правила для Codex / ИИ‑агентов

Репозиторий: `skillra_hse_pda`  
Контекст: учебный проект по Python для анализа данных + фундамент продукта Career & Job Market Navigator (Skillra).

---

## 1. Главный источник правды

1. Основной план работ — в файле `CODEx_PLAN.md`. :contentReference[oaicite:0]{index=0}  
2. Внутри `CODEx_PLAN.md` есть раздел **"6. Execution steps for Codex"** с шагами `Step 0 ... Step 10`.  
3. Codex **НЕ должен пытаться выполнить все шаги сразу**.  
   Пользователь в явном виде говорит, какой именно шаг (`Step N`) нужно сделать сейчас.

При конфликте между:
- старыми файлами/коммитами и
- актуальными инструкциями в `CODEx_PLAN.md` и сообщениях пользователя в чате,

приоритет: **сообщения пользователя → CODEx_PLAN.md**. :contentReference[oaicite:1]{index=1}

---

## 2. Жёсткие ограничения

1. Не изменять файлы в `data/raw/*` (особенно `hh_moscow_it_2025_11_30.csv`).  
2. Все новые таблицы сохранять в `data/processed/`.  
3. Все графики сохранять в `reports/figures/`.  
4. Не добавлять лишних бинарников (кроме данных/ноутбуков).  
5. Не менять историю Git (rebase, squash) — только обычные коммиты и PR.

---

## 3. Ноутбуки и скрипты

1. Главный ноутбук проекта: `notebooks/01_hse_project.ipynb`.
   - После любых изменений он должен выполняться целиком (**Run All**) без ошибок.
   - Все важные таблицы, графики и выводы должны отображаться именно в этом ноутбуке.
   - Сторилайн ноутбука должен соответствовать структуре, описанной в `CODEx_PLAN.md` (этапы 0–4 ТЗ, EDA‑блоки, персоны, выводы). :contentReference[oaicite:2]{index=2}

2. `notebooks/Group_project_draft.ipynb`:
   - это черновик команды, который использовался для экспериментов;
   - полезные идеи и функции из него должны быть интегрированы в `src/skillra_pda/*.py` и `notebooks/01_hse_project.ipynb` (Step 8);
   - после выполнения Step 8 этот ноутбук должен быть удалён из репозитория и больше не создаваться, а ссылки на него — убраны.

3. Логика данных и аналитики по максимуму живёт в `src/skillra_pda/*.py`.  
   В ноутбуке — только воспроизводимые вызовы этих функций, визуализации и текстовые выводы.

4. Скрипты:
   - `scripts/validate_pipeline.py` — smoke‑тест пайплайна (минимальная проверка инвариантов и качества данных).
   - `scripts/run_pipeline.py` — полный аналитический пайплайн (загрузка raw → cleaning → feature engineering → market_view).

---

## 4. Код и архитектура

1. Основной пакет: `src/skillra_pda/`.  
   Не создавай новые пакеты без необходимости.

2. Новые функции и классы:
   - давай им понятные имена,
   - пиши docstring (что делает, какие аргументы и что возвращает),
   - по возможности добавляй простые тесты в `tests/`.

3. **Неиспользуемые функции и код:**
   - Если функция существует в `src/skillra_pda`, в скрипте или в ноутбуке, по умолчанию считаем, что в ней есть ценность.
   - Порядок действий:
     1. Попробовать встроить функцию в общий сторилайн `notebooks/01_hse_project.ipynb` (использовать её для EDA, визуализации или метрик).
     2. Если функция относится к сервисным/helper‑задачам — использовать её в скриптах (`scripts/run_pipeline.py`, `scripts/validate_pipeline.py`) или в persona‑/market‑API.
     3. Удалять функцию — только в крайнем случае, когда:
        - она явно дублирует существующую реализацию, или
        - она не соответствует текущей архитектуре и не несёт ценности.
       При удалении нужно оставить понятное сообщение в PR, почему функция больше не нужна.

4. Не удаляй существующие публичные функции без явной инструкции от пользователя или без явного обоснования в PR.  
   Если нужно изменить поведение — по возможности сохраняй интерфейс (имена и сигнатуры), адаптируя реализацию.

5. При смене интерфейса:
   - обновляй вызовы в `notebooks/`, `scripts/`,
   - при необходимости — документацию в `docs/`.

---

## 5. Корреляционная матрица и аналитические истории

1. В проекте обязательно должен быть реализован блок с корреляционной матрицей для числовых признаков:
   - в `src/skillra_pda/eda.py` — функция(и) для расчёта корреляций;
   - в `src/skillra_pda/viz.py` — функция(и) для построения heatmap;
   - в `notebooks/01_hse_project.ipynb` — отдельная секция с таблицей корреляций, heatmap и текстовыми выводами.

2. Если соответствующие функции уже существуют, Codex должен:
   - переиспользовать их,
   - обеспечить их вызов в ноутбуке,
   - добавить интерпретацию.

---

## 6. Как работать с шагами в CODEx_PLAN.md

1. Пользователь в чате явно говорит:  
   «Сделай сейчас **Step N** из раздела "6. Execution steps for Codex" в `CODEx_PLAN.md`».

2. Codex:
   - читает `CODEx_PLAN.md`,
   - находит описание Step N,
   - составляет краткий план действий по этому шагу (какие файлы будут изменены, какие функции добавлены/использованы, какие ноутбуковые секции обновлены),
   - вносит изменения **только в файлы, перечисленные в Step N**,
   - создаёт отдельный PR с названием, указанным в Step N (например, `step9_storyline_notebook_polish`).

3. Codex **НЕ** выполняет другие Steps (N−1, N+1, …), пока пользователь явно не попросит.

4. Если код уже реализует то, что описано в шаге:
   - либо пропусти шаг (ничего не меняя),
   - либо сделай минимальные улучшения (docstring, дополнительные выводы в ноутбуке), но не переписывай весь модуль.