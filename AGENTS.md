# AGENTS.md — правила работы Codex/агентов в репозитории `skillra_hse_pda`

Этот репозиторий — учебно‑практический проект по рынку IT‑вакансий (hh.ru) и продуктовой упаковке аналитики для Skillra.

**Критическая цель:** получить честный, воспроизводимый и презентационный артефакт:
- пайплайн `raw → clean → features → market_view`,
- ноутбук `notebooks/01_hse_project.ipynb` с выводами, которые **не противоречат данным**,
- HTML‑отчёт `reports/notebooks/01_hse_project.html` с графиками и без кода.

---

## 0) Непререкаемые правила

1) **Всегда сначала прочитай полностью**:
   - `AGENTS.md` (этот файл)
   - `CODEx_PLAN.md` (источник истины по шагам и ограничениям)

2) **Работай строго по одному шагу (Step) за раз.**
   - Нельзя “заодно” делать улучшения из будущих шагов.
   - Один Step = один PR.

3) **Строго соблюдай ограничения на изменяемые файлы.**
   - В каждом Step в `CODEx_PLAN.md` указан список `Allowed files`.
   - Любое изменение вне списка — запрещено.

4) **Нельзя править данные и “результаты руками”.**
   - Не изменять `data/raw/*`.
   - Не “подгонять” выводы в markdown под графики без изменения кода/метрик.
   - Все цифры в выводах должны быть вычислены в коде.

5) **Никаких “тихих” иммутаций (silent imputation) для EDA.**
   - Нельзя заполнять NaN медианой “по умолчанию” во всём датасете.
   - Если заполняем — то только по явной политике (в коде и в docs), и с сохранением `*_known` флагов.

6) **Не ломай публичные интерфейсы.**
   - Если меняешь сигнатуры функций, делай это совместимо (backward‑compatible) либо обновляй все места использования в рамках текущего Step (если это разрешено списком файлов).

---

## 1) Протокол выполнения шага (Step) в Codex

В каждом Step агент обязан:

1) Сказать **короткий план**: какие файлы меняются и зачем.

2) Сделать изменения в рамках `Allowed files`.

3) Запустить проверки (по возможности):
   - `python scripts/run_pipeline.py` (если Step затрагивает cleaning/features/eda/market)
   - `python scripts/validate_pipeline.py` (если Step затрагивает пайплайн)
   - `python scripts/validate_notebook.py` (если Step затрагивает ноутбук/HTML экспорт)
   - `pytest`

4) В ответе указать:
   - какие команды запустил,
   - что получилось (успешно/ошибка),
   - что изменилось (файлы/суть),
   - где лежат артефакты (`reports/notebooks/01_hse_project.html`, `reports/figures/*`).

5) Открыть PR с именем, указанным в Step.

**Запрещено:** остановиться на “План: …” и ничего не изменить.  
Если тебя попросили “сделать Step”, ты обязан написать код/правки.

---

## 2) Стандарты аналитики и данных (must-have)

### 2.1. Пропуски и `unknown`

- Различай:
  - **не требуется / none** — это валидная категория,
  - **unknown / не указано / пусто** — это отсутствие информации.

- Для отчёта всегда показывай:
  - размер выборки `n` (сколько вакансий в сегменте),
  - долю `unknown/NaN` для ключевых признаков (grade, work_mode, english_level, salary).

- Если доля `unknown/NaN` большая — добавляй дисклеймер:
  - “X% вакансий не указывают ..., поэтому доли могут быть смещены”.

### 2.2. Стабильность сегментов

- Любой сегмент (роль/город/режим/грейд) для выводов должен иметь достаточный размер.
- Для персон обязательна проверка `min_market_n` и fallback‑логика (ослабление фильтров).
- Если сегмент мал — вывод должен это явно сообщать и не делать сильных утверждений.

---

## 3) Стандарты ноутбука (01_hse_project.ipynb)

1) **Одна ячейка = один график** (максимум два тесно связанных).
2) После каждого графика — markdown‑ячейка:
   - что на графике (с цифрами),
   - выводы про рынок (с цифрами),
   - выводы для Skillra (что делать продукту).
3) Цифры не пишем руками:
   - используем код и выводим markdown через `IPython.display.Markdown`.
4) Упорядочивание категорий:
   - grade и english должны быть отсортированы смыслово (intern→…→unknown).
5) Дубликаты графиков удаляем.

---

## 4) Стандарты графиков

- Заголовки и подписи осей — на русском.
- Единые размеры:
  - bar/box/line: единый размер,
  - heatmap: отдельный размер.
- Функции визуализации, используемые в ноутбуке, должны поддерживать:
  - `return_fig=True` и возвращать `(Figure, Path)`.

---

## 5) PR чек‑лист

В описании PR обязательно:

- список изменённых файлов,
- “что было → что стало” (коротко),
- команды, которые запускались, и их результат,
- если менялись выводы/графики — что конкретно исправилось (например: “Python теперь попадает в топ‑навыки data‑рынка, потому что учитываем has_* вместе со skill_*”).

---
