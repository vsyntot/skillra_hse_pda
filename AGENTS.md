---

# Skillra PDA — AGENTS (правила для Codex и людей)

## 0. TL;DR
- Один шаг из `CODEx_PLAN.md` = один PR.
- Меняем **только** файлы, перечисленные в конкретном Step.
- После каждого PR: `pytest -q` + smoke-тесты (`scripts/validate_pipeline.py`), а если менялся ноутбук — **Run All**.
- Не допускаем “магии”: все цифры в выводах ноутбука должны быть либо:
  - вычислены в коде (f-string), либо
  - явно помечены как “пример/оценка”.

---

## 1) Контекст проекта
Это учебно-продуктовый проект Skillra PDA (Career & Job Market Navigator):
- вход: сырые вакансии HH (в `data/raw/`)
- пайплайн: чистка → фичи → витрина `market_view`
- выход: аналитический ноутбук + HTML-репорт + кодовая база для повторяемости

---

## 2) Жёсткие ограничения (non‑negotiables)
1) **НЕ трогать код парсера** в папке `parser/` без отдельного явного запроса пользователя.
2) **НЕ редактировать данные** в `data/raw/` (включая CSV/JSON/пиклы/паркет).
3) Можно создавать/обновлять только:
   - `data/processed/` (артефакты пайплайна),
   - `reports/` (артефакты графиков/таблиц/HTML).
4) Любые изменения интерфейсов функций в `src/skillra_pda/` требуют:
   - обновления вызовов в `notebooks/` и `scripts/`,
   - при необходимости — обновления `docs/`.

---

## 3) Ноутбуки и отчёты
1) Главный ноутбук проекта: `notebooks/01_hse_project.ipynb`.
   - После любых изменений он должен выполняться целиком (**Run All**) без ошибок.
2) Главная логика аналитики должна жить в `src/skillra_pda/*.py`.
   - В ноутбуке — оркестрация, визуализация, сторилайн, минимум “сырой логики”.
3) Скрипты:
   - `scripts/validate_pipeline.py` — smoke‑тест пайплайна.
   - `scripts/validate_notebook.py` — прогон ноутбука и экспорт HTML.

---

## 4) Стандарты данных и аналитики
1) Везде, где возможно, используем нормализованные признаки:
   - `grade_final` вместо `grade` (если есть),
   - нормализованный english level (если есть в EDA),
   - `salary_mid_rub_capped` как основной ориентир по зарплате.
2) Колонки с высокой долей пропусков:
   - не используем для ключевых выводов,
   - явно показываем их как “sparse / unreliable” в data health секции.
3) Навыки:
   - `has_*` и `skill_*` считаются hard skills.
   - “особые флаги” (например `has_metro`, `has_test_task`, `has_mentoring`) **не являются навыками** и не должны попадать в топ‑скиллы или skill-gap.
4) Роли:
   - `primary_role` — удобен для витрин и простых разрезов, но может быть слишком “узким”.
   - Для “ключевых ролей” (frontend/fullstack/product) допускается считать статистики по role-флагам `role_*`.

---

## 5) Визуализация и выводы (чтобы не было дублей)
1) **Правило одного вывода**: один график должен появляться в ноутбуке ровно один раз.
2) Стандарт для ноутбука + HTML (рекомендуется):
   - функция строит график и сохраняет в `reports/figures/*.png`,
   - в ноутбуке показываем только `Image(path)` через `display(...)`.
3) Если где-то используется `return_fig=True`, то:
   - **нельзя** дополнительно делать `display(Image(path))` в той же ячейке,
   - иначе получатся дубли в ноутбуке и/или HTML.

---

## 6) Как работать с шагами в CODEx_PLAN.md
1) Пользователь в чате явно говорит:
   «Сделай сейчас Step N из раздела "Execution steps for Codex" в `CODEx_PLAN.md`».
2) Codex обязан:
   - прочитать `CODEx_PLAN.md`,
   - найти Step N,
   - сделать изменения **только в перечисленных файлах**,
   - создать отдельный PR с названием из шага.
3) Codex **не выполняет** другие шаги, пока пользователь явно не попросит.

---

## 7) Если Codex вернул только план, но не написал код
Иногда Codex в web-интерфейсе может остановиться на “плане”.
В этом случае:
- нужно явно сказать: **“Proceed / Implement now”**,
- или повторить запрос, добавив фразу:
  “Не останавливайся на плане — внеси изменения, закоммить, открой PR”.

---
